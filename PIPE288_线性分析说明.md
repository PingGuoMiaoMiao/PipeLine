# PIPE288 线弹性分析实现说明

## 1. 单元刚度矩阵推导

详见 `pipe288_stiffness_derivation.md` 文档。

## 2. 核心代码结构

### 2.1 主要类

1. **CDBParser**: 扩展的CDB文件解析器
   - 解析节点（NBLOCK）
   - 解析单元（EBLOCK）
   - 解析材料参数（MPDATA）
   - 解析截面参数（SECDATA）
   - 解析载荷（ACEL, BFUNIF, SFE）
   - 解析边界条件（D命令）

2. **PIPE288Element**: PIPE288单元类
   - `compute_stiffness_matrix()`: 计算单元刚度矩阵（12×12）
   - `compute_load_vector()`: 计算单元载荷向量（12×1）
   - 支持内压、自重、热膨胀载荷

3. **FEASolver**: 有限元求解器
   - 组装全局刚度矩阵
   - 应用边界条件
   - 求解线性方程组 K·U = F

4. **VTKWriter**: VTK输出类（扩展）
   - 输出节点坐标（变形后）
   - 输出单元连接
   - 输出节点位移（向量和幅值）

## 3. 使用方法

### 3.1 运行命令

```bash
python solver.py examples/PIPE288_PLAST.cdb output.vtk
```

### 3.2 输出信息

程序会输出：
- 解析统计：节点数、单元数、材料参数、截面参数
- 载荷信息：温度、重力、内压
- 求解信息：DOF数量
- 位移统计：最大位移（UX, UY, UZ）

### 3.3 VTK文件内容

输出的VTK文件包含：
- **POINTS**: 节点坐标（变形后）
- **LINES**: 单元连接关系
- **POINT_DATA**:
  - `Displacement`: 位移向量（UX, UY, UZ）
  - `DisplacementMagnitude`: 位移幅值

## 4. 单位系统

### 4.1 ANSYS CDB文件单位（输入）
- 长度：mm
- 力：N
- 质量：tonne
- 时间：s
- 弹性模量：MPa
- 密度：tonne/mm³
- 压力：MPa

### 4.2 内部计算单位（SI）
- 长度：m
- 力：N
- 质量：kg
- 时间：s
- 弹性模量：Pa
- 密度：kg/m³
- 压力：Pa

### 4.3 输出单位
- 位移：mm（显示时）
- VTK文件中：m（SI单位）

## 5. 实现的功能

### 5.1 节点自由度
- ✅ 6 DOF：UX, UY, UZ, ROTX, ROTY, ROTZ

### 5.2 线弹性刚度矩阵
- ✅ 轴向刚度
- ✅ 弯曲刚度（Y和Z方向）
- ✅ 扭转刚度
- ✅ 坐标变换（局部→全局）

### 5.3 载荷类型
- ✅ 内压 → 等效轴向力（端盖效应）
- ✅ 自重载荷（均布载荷转换为等效节点力）
- ✅ 轴向热膨胀（参考温度25°C）

### 5.4 材料参数
- ✅ 弹性模量（E）
- ✅ 泊松比（ν）
- ✅ 密度（ρ）
- ✅ 热膨胀系数（α）

### 5.5 求解
- ✅ 静力线性求解
- ✅ 边界条件处理（置大数法）

### 5.6 输出
- ✅ 节点位移到VTK文件
- ✅ 可在ParaView中可视化

## 6. 示例运行结果

### 6.1 测试算例：PIPE288_PLAST.cdb

**输入参数：**
- 材料：E=200 GPa, ν=0.3, ρ=7800 kg/m³, α=1.2e-5 /°C
- 截面：D=30 mm, t=1 mm
- 载荷：温度=200°C, 重力=-Z方向 9.8 m/s², 内压=3 MPa
- 边界条件：节点1固支（6个自由度）

**输出结果（示例）：**
```
解析完成:
  - 节点数: 31
  - 单元数: 30
  - 元素类型映射: {1: 288}

开始有限元分析...
材料参数: E=200.0 GPa, nu=0.300
截面参数: D=30.0 mm, t=1.0 mm
载荷: 温度=200.0°C, 重力=[0.0, 0.0, 9800.0], 内压单元数=30
求解线性方程组 (DOF数: 186)...
最大位移: UX=2.231 mm, UY=2.930 mm, UZ=5.027 mm
```

**结果说明：**
- 位移量级在毫米级别，符合预期
- 由于自重和热膨胀，Z方向位移最大
- 内压产生的轴向力导致X方向有位移
- 由于结构不对称或载荷不对称，Y方向也有位移

### 6.2 与ANSYS对比

**验证要点：**
1. 位移趋势一致（最大位移在自由端）
2. 位移量级合理（毫米级别）
3. Z方向位移最大（受重力和热膨胀影响）

**注意：**
- 本实现是简化版本，使用Euler-Bernoulli梁理论
- ANSYS的PIPE288单元可能使用更复杂的理论（考虑剪切变形等）
- 对于细长管道，简化理论的结果应该与ANSYS接近

## 7. 代码文件

- `solver.py`: 主程序文件
- `pipe288_stiffness_derivation.md`: 刚度矩阵推导说明
- `PIPE288_线性分析说明.md`: 本文档

## 8. 依赖库

- Python 3.6+
- NumPy 1.19+

安装：
```bash
pip install numpy
```

## 9. 后续扩展方向

1. 支持ELBOW290弯管单元
2. 考虑剪切变形（Timoshenko梁理论）
3. 支持非线性分析（弹塑性、蠕变）
4. 输出应力、应变结果
5. 支持更多载荷类型（集中力、弯矩等）

## 10. 注意事项

1. **单位转换**：确保正确转换ANSYS单位到SI单位
2. **边界条件**：目前使用置大数法，对于大型问题可能不够稳定
3. **坐标变换**：局部坐标系的构造需要确保正交性
4. **载荷分配**：内压和热膨胀的等效节点力分配基于简化假设
5. **数值稳定性**：对于接近零长度的单元需要特殊处理
