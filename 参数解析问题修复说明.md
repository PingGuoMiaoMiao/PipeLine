# 参数解析问题修复说明

## 问题总结

用户指出生成的VTK文件与算例说明不一致，主要原因是CDB文件解析器缺少以下关键参数的解析：

1. **TB BISO参数**：弹塑性材料的屈服应力和切线模量
2. **TB CREEP参数**：蠕变材料的C1, C2, C3, C4参数
3. **密度单位转换**：需要确认是否正确

## 已修复的问题

### 1. TB BISO弹塑性参数解析

**CDB文件格式：**
```
TB,BISO,       1,   1
TBTEM,  0.00000000    ,   1
TBDAT,      1,  25.0000000    ,  100000.000    ,
```

**修复内容：**
- 添加 `_parse_tb_biso()` 方法
- 解析TBDAT行获取屈服应力（25.0 MPa）和切线模量（100000.0 MPa = 100 GPa）
- 单位转换：MPa → Pa

**对应算例说明：**
- BISO模型屈服应力：25 MPa ✓
- 切线模量：100 GPa ✓

### 2. TB CREEP蠕变参数解析

**CDB文件格式：**
```
TB,CREE,       1,   1,   4,1
TBFIELD,Temps,0.000000
TBDATA,1,1.000000e-014,2.000000e+000,-1.000000e+000
TBDATA,4,0.000000e+000
```

**修复内容：**
- 添加 `_parse_tb_creep()` 方法
- 解析TBDATA行获取C1, C2, C3, C4参数
- C4默认为0.0（如果没有指定）

**对应算例说明：**
- C1 = 1.000000e-014 ✓
- C2 = 2 ✓
- C3 = -1 ✓
- C4 = 0 ✓

### 3. 密度单位转换验证

**CDB文件中的值：**
```
MPDATA,R5.0, 1,DENS,       1, 1, 7.800000000E-09,
```

**转换说明：**
- ANSYS CDB中密度单位为 tonne/mm³
- 7.8e-09 tonne/mm³ = 7.8e-09 * 1e12 kg/m³ = 7800 kg/m³ ✓
- 转换系数 1e12 是正确的

**对应算例说明：**
- 密度：7800 kg/m³ ✓

## 其他已验证的参数

### 材料参数
- 弹性模量：200 GPa (200000.0 MPa) ✓
- 泊松比：0.3 ✓
- 热膨胀系数：1.2E-5 ✓
- 参考温度：25°C ✓

### 截面参数
- 直径：30.0 mm (PIPE288) ✓
- 壁厚：1.0 mm (PIPE288) ✓

### 载荷参数
- 温度：200°C ✓
- 重力：-Z方向，9800 mm/s² = 9.8 m/s² ✓
- 内压：3.0 MPa ✓

## 修复后的代码位置

**文件：** `solver/mesh/cdb_parser.py`

**新增方法：**
1. `_parse_tb_biso()`: 解析TB BISO弹塑性参数
2. `_parse_tb_creep()`: 解析TB CREEP蠕变参数

**修改的方法：**
1. `parse()`: 添加TB BISO和TB CREEP的解析调用
2. `_parse_mpdata()`: 添加密度单位转换的注释说明

## 验证方法

运行以下命令验证参数解析：

```bash
# 验证弹塑性参数
python -c "from solver.mesh.cdb_parser import CDBParser; p = CDBParser('examples/PIPE288_PLAST.cdb'); p.parse(); mat = p.materials.get(1, {}); print(f'屈服应力: {mat.get(\"yield_stress\", 0)/1e6:.1f} MPa'); print(f'切线模量: {mat.get(\"tangent_modulus\", 0)/1e9:.1f} GPa')"

# 验证蠕变参数
python -c "from solver.mesh.cdb_parser import CDBParser; p = CDBParser('examples/PIPE288_CREEP.cdb'); p.parse(); mat = p.materials.get(1, {}); print(f'C1: {mat.get(\"C1\", 0):.2e}'); print(f'C2: {mat.get(\"C2\", 0):.1f}'); print(f'C3: {mat.get(\"C3\", 0):.1f}'); print(f'C4: {mat.get(\"C4\", 0):.1f}')"
```

## 下一步

1. 重新运行所有分析，生成新的VTK文件
2. 验证结果与算例说明是否一致
3. 检查主程序是否正确使用解析出的参数

